@let form = roleForm();
<form (submit)="onSubmit($event)">
  <div class="mb-6 grid grid-cols-1 gap-4 lg:grid-cols-2">
    <mat-form-field class="w-full">
      <mat-label>Name</mat-label>
      <input matInput [formField]="form.name" />
    </mat-form-field>

    <mat-form-field class="w-full">
      <mat-label>Description</mat-label>
      <textarea
        matInput
        [formField]="form.description"
      ></textarea>
    </mat-form-field>

    <mat-checkbox [formField]="form.defaultUserRole">
      Every new user should get this role
    </mat-checkbox>

    <mat-checkbox [formField]="form.defaultOrganizerRole">
      An organizer registration should be available to this role by default
    </mat-checkbox>

    <mat-checkbox [formField]="form.showInHub">
      Show this role in the hub
    </mat-checkbox>

    @if (form.showInHub().value()) {
      <mat-checkbox [formField]="form.collapseMembersInHup">
        Collapse the members of this role by default
      </mat-checkbox>
    }

    <div
      class="grid grid-cols-1 gap-4 lg:col-span-2 lg:grid-cols-4"
    >
      @for (group of groupStates(); track group.key) {
        <div class="bg-surface text-on-surface rounded-2xl p-2">
          <mat-checkbox
            [checked]="group.checked"
            [indeterminate]="group.indeterminate"
            (change)="toggleGroup(group, $event.checked)"
            class="font-medium"
          >
            {{ group.label }}
          </mat-checkbox>

          <div class="ml-8 grid grid-cols-1 gap-2">
            @for (permission of group.permissions; track permission.key) {
              <div class="flex flex-col">
                <mat-checkbox
                  [formField]="form.permissions[permission.key]"
                  [matTooltip]="getPermissionTooltip(permission.key)"
                >
                  {{ permission.label }}
                </mat-checkbox>
                @if (getDependentPermissions(permission.key).length > 0) {
                  <div class="text-on-surface-variant ml-6 text-xs">
                    Includes:
                    {{ getDependentPermissions(permission.key).join(", ") }}
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>
  <button
    type="submit"
    mat-button
    [disabled]="form().invalid() || form().submitting() || isSubmitting()"
  >
    {{ submitLabel() }}
  </button>
</form>

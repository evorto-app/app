<div class="mb-4 flex flex-row items-center gap-2">
  <a routerLink="/templates" mat-icon-button>
    <fa-duotone-icon [icon]="faArrowLeft"></fa-duotone-icon>
  </a>
  <h1 class="title-large">
    {{ templateQuery.data()?.title ?? "Loading ..." }}
  </h1>
  <div class="grow"></div>
  <button title="menu" mat-icon-button [matMenuTriggerFor]="menu">
    <fa-duotone-icon [icon]="faEllipsisVertical"></fa-duotone-icon>
  </button>
  <mat-menu #menu="matMenu">
    <a mat-menu-item routerLink="edit">Edit template</a>
  </mat-menu>
</div>

@if (templateQuery.isError()) {
  <p>Error: {{ templateQuery.error().message }}</p>
} @else if (templateQuery.isSuccess()) {
  <a mat-fab extended routerLink="create-event" class="fab-fixed">
    <mat-icon svgIcon="faPlus"></mat-icon>
    Create event
  </a>

  <div class="flex flex-col gap-4">
    <section class="rounded-2xl bg-surface p-4 text-on-surface">
      <div
        class="prose dark:prose-invert"
        [innerHTML]="templateQuery.data().description"
      ></div>
    </section>

    <section
      class="rounded-2xl bg-surface-container-high p-4 text-on-surface-container-high"
    >
      <h2 class="mb-6 text-lg font-semibold">Registration Options</h2>

      <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
        @for (
          option of templateQuery.data().registrationOptions;
          track option.id
        ) {
          <div
            class="flex flex-col gap-4 rounded-xl bg-surface p-4 text-on-surface"
          >
            <div class="flex items-center gap-2">
              <h3 class="text-lg font-medium">{{ option.title }}</h3>
              <div
                class="flex items-center gap-1 rounded bg-primary-container px-2 py-0.5 text-sm"
              >
                <span>{{ option.spots }}</span>
                <span>spots</span>
              </div>
            </div>

            <div class="grid gap-3">
              <div class="flex flex-col">
                <span class="text-on-surface-variant text-sm"
                  >Registration</span
                >
                <div class="flex items-center gap-1">
                  <span class="font-medium">{{
                    option.registrationMode | titlecase
                  }}</span>
                  <span class="text-on-surface-variant">Â·</span>
                  @if (option.isPaid) {
                    <span>{{ option.price / 100 | currency }}</span>
                  } @else {
                    <span>Free</span>
                  }
                </div>
              </div>

              <div class="flex flex-col">
                <span class="text-on-surface-variant text-sm">Timeline</span>
                <div class="flex flex-col gap-1">
                  <div class="flex items-center gap-2">
                    <fa-duotone-icon
                      [icon]="faClock"
                      class="text-on-surface-variant text-sm"
                    ></fa-duotone-icon>
                    <span
                      >Opens {{ option.openRegistrationOffset }} hours before
                      event</span
                    >
                  </div>
                  <div class="flex items-center gap-2">
                    <fa-duotone-icon
                      [icon]="faClockFour"
                      class="text-on-surface-variant text-sm"
                    ></fa-duotone-icon>
                    <span
                      >Closes {{ option.closeRegistrationOffset }} hours before
                      event</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    </section>
  </div>
}

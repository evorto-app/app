<div class="mb-4 flex w-full flex-row items-center gap-2">
  <a routerLink="/events/{{ eventId() }}" mat-icon-button>
    <fa-duotone-icon [icon]="faArrowLeft" />
  </a>
  <h1 class="title-large">{{ eventQuery.data()?.title ?? "Loading ..." }}</h1>
  <div class="grow"></div>
  <button
    title="menu"
    *appIfAnyPermission="['events:changeListing']"
    mat-icon-button
    [matMenuTriggerFor]="menu"
  >
    <fa-duotone-icon [icon]="faEllipsisVertical" />
  </button>
  <mat-menu #menu="matMenu">
    <!--    <button mat-menu-item (click)="updateVisibility()">-->
    <!--      Update visibility-->
    <!--    </button>-->
  </mat-menu>
</div>
<main>
  <form (submit)="saveEvent($event)">
    <div class="grid gap-6">
      <section class="bg-surface text-on-surface rounded-2xl p-4">
        <h2 class="title-large mb-4">Event Details</h2>
        <app-event-general-form [generalForm]="editEventForm" />
      </section>

      <section
        class="bg-surface-container-high text-on-surface-container-high rounded-2xl p-2"
      >
        <h2 class="title-large mb-4 p-2">Registration Options</h2>
        <div
          class="grid grid-cols-1 gap-6 lg:grid-cols-2 lg:[grid-template-rows:auto_auto_auto_auto_auto_auto_auto]"
        >
          @for (option of editEventForm.registrationOptions; track option) {
            <app-registration-option-form
              class="bg-surface text-on-surface rounded-xl p-4 grid gap-4 lg:row-span-7 lg:grid-rows-subgrid"
              [esnEnabled]="esnEnabled()"
              [registrationOptionForm]="option"
              [registrationModes]="registrationModes"
            />
          }
        </div>
      </section>

      <div class="flex justify-end">
        <button
          type="submit"
          mat-button
          [disabled]="
            editEventForm().invalid() ||
            editEventForm().submitting() ||
            updateEventMutation.isPending()
          "
        >
          @if (updateEventMutation.isPending()) {
            Saving...
          } @else {
            Save Changes
          }
        </button>
        @if (updateEventMutation.error()) {
          <div class="text-error mt-2 text-sm">
            Failed to save event. Please try again.
          </div>
        }
      </div>
    </div>
  </form>
</main>

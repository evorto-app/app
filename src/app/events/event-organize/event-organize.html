<div class="bg-surface text-on-surface p-4 lg:h-full lg:rounded-t-lg">
  <div class="mb-4 flex w-full flex-row items-center gap-2">
    <a [routerLink]="['/events', eventId()]" mat-icon-button>
      <fa-duotone-icon [icon]="faArrowLeft"></fa-duotone-icon>
    </a>
    <h1 class="title-large">{{ event()?.title || "Loading..." }}</h1>
    <div class="grow"></div>
    @if (event()) {
      <span class="text-surface-variant text-sm">
        {{ event()!.start | date: "shortDate" }} •
        {{ event()!.start | date: "shortTime" }}
      </span>
    }
  </div>

  <main class="lg:overflow-y-auto">
    <div class="grid gap-8">
      <!-- Quick Stats Cards -->
      <section>
        <h2 class="title-large mb-4">Overview</h2>
        <div class="text-on-surface-container grid grid-cols-3 gap-4">
          <div class="bg-surface-container rounded-lg p-4 text-center">
            <div class="flex flex-col items-center justify-center lg:flex-row">
              <div class="text-2xl font-bold">{{ stats().registered }}</div>
              <div class="text-lg font-bold">/{{ stats().capacity }}</div>
            </div>
            <div class="text-sm">Registered</div>
          </div>
          <div
            class="bg-surface-container flex flex-col justify-center rounded-lg p-4 text-center"
          >
            <div class="text-2xl font-bold">{{ stats().checkedIn }}</div>
            <div class="text-sm">Checked In</div>
          </div>
          <div
            class="bg-surface-container flex flex-col justify-center rounded-lg p-4 text-center"
          >
            <div class="text-2xl font-bold">
              {{ stats().capacityPercentage | percent: "1.0-0" }}
            </div>
            <div class="text-sm">Capacity</div>
          </div>
        </div>
      </section>

      <!-- Management Section -->
      <section class="grid gap-4">
        <h2 class="title-large">Participants</h2>
        @for (
          registrationOption of organizerOverviewQuery.data();
          track registrationOption.registrationOptionId
        ) {
          <div
            class="bg-surface-container text-on-surface-container grid gap-2 rounded-lg p-4"
          >
            <h3 class="title-medium">
              {{ registrationOption.registrationOptionTitle }}
            </h3>
            @for (user of registrationOption.users; track user.userId) {
              <div class="flex gap-2">
                <p>{{ user.firstName }} {{ user.lastName }}</p>
              </div>
            }
          </div>
        }
        <!--        <table mat-table [dataSource]="organizerTableContent()">-->
        <!--          <ng-container matColumnDef="name">-->
        <!--            <th mat-header-cell *matHeaderCellDef>Name</th>-->
        <!--            <td mat-cell *matCellDef="let user">-->
        <!--              {{ user.name }}-->
        <!--            </td>-->
        <!--          </ng-container>-->
        <!--          <ng-container matColumnDef="email">-->
        <!--            <th mat-header-cell *matHeaderCellDef>Email</th>-->
        <!--            <td mat-cell *matCellDef="let user">-->
        <!--              {{ user.email }}-->
        <!--            </td>-->
        <!--          </ng-container>-->
        <!--          <ng-container matColumnDef="checkin">-->
        <!--            <th mat-header-cell *matHeaderCellDef>Check in status</th>-->
        <!--            <td mat-cell *matCellDef="let user">-->
        <!--              {{ user.checkin }}-->
        <!--            </td></ng-container-->
        <!--          >-->
        <!--          <ng-container matColumnDef="registration-option">-->
        <!--            <td-->
        <!--              mat-cell-->
        <!--              [colSpan]="organizerTableColumns().length"-->
        <!--              *matCellDef="let registrationOption"-->
        <!--            >-->
        <!--              {{ registrationOption.title }}-->
        <!--            </td></ng-container-->
        <!--          >-->
        <!--          <tr mat-header-row *matHeaderRowDef="organizerTableColumns()"></tr>-->
        <!--          <tr-->
        <!--            mat-row-->
        <!--            *matRowDef="-->
        <!--              let row;-->
        <!--              columns: organizerTableColumns();-->
        <!--              when: showOrganizerRow-->
        <!--            "-->
        <!--          ></tr>-->
        <!--          <tr-->
        <!--            mat-row-->
        <!--            *matRowDef="-->
        <!--              let row;-->
        <!--              columns: ['registration-option'];-->
        <!--              when: showRegistrationOptionRow-->
        <!--            "-->
        <!--          ></tr>-->
        <!--        </table>-->
      </section>

      <section class="grid gap-4">
        <div class="flex items-center justify-between gap-4">
          <h2 class="title-large">Receipts</h2>
          <button
            mat-raised-button
            color="primary"
            (click)="openReceiptDialog()"
            [disabled]="submitReceiptMutation.isPending()"
          >
            Add receipt
          </button>
        </div>

        @if (receiptsByEventQuery.isPending()) {
          <div class="bg-surface-container rounded-lg p-4">
            Loading receipts...
          </div>
        } @else if (receiptsByEventQuery.isError()) {
          <div class="bg-error-container text-on-error-container rounded-lg p-4">
            Failed to load receipts.
          </div>
        } @else if (receiptsByEventQuery.data()?.length === 0) {
          <div class="bg-surface-container rounded-lg p-4">
            No receipts submitted for this event yet.
          </div>
        } @else {
          <div class="grid gap-3">
            @for (receipt of receiptsByEventQuery.data(); track receipt.id) {
              <article class="bg-surface-container rounded-lg p-4">
                <div class="flex flex-wrap items-center justify-between gap-2">
                  <h3 class="title-medium">{{ receipt.attachmentFileName }}</h3>
                  <span class="rounded bg-surface px-2 py-1 text-xs uppercase">
                    {{ receipt.status }}
                  </span>
                </div>
                <p class="text-on-surface-variant text-sm">
                  Submitted by {{ receipt.submittedByFirstName }}
                  {{ receipt.submittedByLastName }} on
                  {{ receipt.createdAt | date: "medium" }}
                </p>
                <div class="mt-3 grid grid-cols-1 gap-2 text-sm md:grid-cols-3">
                  <p>Total: {{ receipt.totalAmount / 100 | number: "1.2-2" }} €</p>
                  <p>Tax rate: {{ receipt.stripeTaxRateId }}</p>
                  <p>Date: {{ receipt.receiptDate | date: "mediumDate" }}</p>
                </div>
                @if (receipt.previewImageUrl) {
                  <a
                    [href]="receipt.previewImageUrl"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="mt-2 inline-block text-sm underline"
                  >
                    Open preview
                  </a>
                }
              </article>
            }
          </div>
        }
      </section>
    </div>
  </main>
</div>
